<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä»™äººmusic</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 text-gray-900 min-h-screen pb-40">

<!-- ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== -->
<header class="bg-white shadow-md p-4 flex justify-center sticky top-0 z-10">
  <form id="searchForm" class="flex w-full max-w-xl gap-2">
    <input
      id="query"
      type="text"
      placeholder="éŸ³æ¥½ã‚’æ¤œç´¢ ğŸ§"
      class="flex-1 p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400"
      required
    >
    <button
      class="bg-blue-500 hover:bg-blue-600 text-white px-5 rounded-lg font-semibold transition">
      ğŸ”
    </button>
  </form>
</header>

<!-- ===== ãƒ¡ã‚¤ãƒ³ ===== -->
<main class="max-w-2xl mx-auto p-4" id="results">
  <p class="text-center text-gray-500 mt-10">
    æ¤œç´¢ã—ã¦éŸ³æ¥½ã‚’æ¢ãã† ğŸ¶
  </p>
</main>

<!-- ===== å†ç”Ÿä¸­ãƒãƒ¼ ===== -->
<div
  id="playerBox"
  class="fixed bottom-0 left-0 w-full bg-white border-t shadow-xl hidden">

  <!-- å†ç”Ÿä¸­æƒ…å ± -->
  <div class="flex items-center gap-4 p-3">
    <img
      id="nowArtwork"
      class="w-14 h-14 rounded-lg bg-gray-200"
    >
    <div class="flex-1 min-w-0">
      <p id="nowTitle" class="font-bold truncate"></p>
      <p id="nowArtist" class="text-sm text-gray-500 truncate"></p>
    </div>
  </div>

  <!-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
  <iframe
    id="player"
    class="w-full h-28 border-t"
    allow="autoplay">
  </iframe>
</div>

<script>
const form = document.getElementById("searchForm");
const results = document.getElementById("results");
const playerBox = document.getElementById("playerBox");
const player = document.getElementById("player");

const nowArtwork = document.getElementById("nowArtwork");
const nowTitle = document.getElementById("nowTitle");
const nowArtist = document.getElementById("nowArtist");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const q = document.getElementById("query").value.trim();
  if (!q) return;

  results.innerHTML = `
    <p class="text-center text-gray-500 mt-10">æ¤œç´¢ä¸­â€¦</p>
  `;

  try {
    const res = await fetch(`/music/search?q=${encodeURIComponent(q)}`);
    const data = await res.json();

    if (!data.tracks || data.tracks.length === 0) {
      results.innerHTML = `
        <p class="text-center text-gray-500 mt-10">
          æ›²ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ ğŸ˜¢
        </p>
      `;
      return;
    }

    results.innerHTML = "";

    data.tracks.forEach(track => {
      const div = document.createElement("div");
      div.className = `
        bg-white p-4 mb-4 rounded-xl shadow
        flex gap-4 items-center
        hover:shadow-lg transition
      `;

      div.innerHTML = `
        <img
          src="${track.artwork_url || ''}"
          class="w-16 h-16 rounded-lg bg-gray-200"
        >
        <div class="flex-1 min-w-0">
          <p class="font-bold truncate">${track.title}</p>
          <p class="text-sm text-gray-500 truncate">${track.username}</p>
        </div>
        <button
          class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-bold transition">
          â–¶
        </button>
      `;

      div.querySelector("button").onclick = () => {
        // å†ç”Ÿ
        player.src =
          `https://w.soundcloud.com/player/?url=https://api.soundcloud.com/tracks/${track.id}&auto_play=true`;

        // å†ç”Ÿä¸­è¡¨ç¤º
        nowArtwork.src = track.artwork_url || "";
        nowTitle.textContent = track.title;
        nowArtist.textContent = track.username;

        playerBox.classList.remove("hidden");
      };

      results.appendChild(div);
    });

  } catch (e) {
    results.innerHTML = `
      <p class="text-center text-red-500 mt-10">
        é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ
      </p>
    `;
  }
});
</script>

</body>
</html>
